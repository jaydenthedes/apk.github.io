(function () {
  var a = this, b = function (b, c) {
    var f = b.split("."), g = window || a;
    f[0]in g || !g.execScript || g.execScript("var " + f[0]);
    for (var h; f.length && (h = f.shift());)f.length || void 0 === c ? g = g[h] ? g[h] : g[h] = {} : g[h] = c
  }, c = function (a) {
    var b = chrome.runtime.connect("nmmhkkegccagdldgiimedpiccmgmieda", {}), c = !1;
    b.onMessage.addListener(function (b) {
      c = !0;
      "response"in b && !("errorType"in b.response) ? a.success && a.success(b) : a.failure && a.failure(b)
    });
    b.onDisconnect.addListener(function () {
      !c && a.failure && a.failure({
        request: {},
        response: {errorType: "INTERNAL_SERVER_ERROR"}
      })
    });
    b.postMessage(a)
  };
  b("google.payments.inapp.buy", function (a) {
    a.method = "buy";
    c(a)
  });
  b("google.payments.inapp.consumePurchase", function (a) {
    a.method = "consumePurchase";
    c(a)
  });
  b("google.payments.inapp.getPurchases", function (a) {
    a.method = "getPurchases";
    c(a)
  });
  b("google.payments.inapp.getSkuDetails", function (a) {
    a.method = "getSkuDetails";
    c(a)
  })
})();
var _TOPBAR_HEIGHT = 32, _ALLOWED_VALUES_MAP = {
  formFactor: ["maximized", "phone", "tablet"],
  fpsLimit: [1, 2, 3, 4, 5, 6, 10, 12, 15, 20, 30, 60],
  ndkAbi: ["armeabi", "armeabi-v7a"],
  orientation: ["landscape", "portrait"],
  resize: ["disabled", "scale"],
  stderrLog: "DVIWEFS".split("")
}, _common = {cachedRuntimeManifestPromise: null}, _STRING_DELIMITER = "\u0001", _TARGET_ANDROID_DP = {
  phone: {
    "long": 640,
    "short": 360
  }, tablet: {"long": 1280, "short": 800}
};
function getTimeZone() {
  var a = -(new Date).getTimezoneOffset(), b = 0 <= a ? "+" : "-", a = Math.abs(a), c = String(Math.floor(a / 60)), a = String(a % 60);
  1 == c.length && (c = "0" + c);
  1 == a.length && (a = "0" + a);
  return "GMT" + b + c + ":" + a
}
function getLocale() {
  var a = window.navigator.language;
  "es-419" == a && (a = "es");
  a = a.split("-");
  return {language: a[0], country: a[1]}
}
function getCurrentZoom() {
  if (!document.body)return 1;
  var a = document.createElementNS("http://www.w3.org/2000/svg", "svg");
  a.style.cssText = "position: absolute;visibility: hidden;";
  document.body.appendChild(a);
  var b = a.currentScale;
  document.body.removeChild(a);
  return b
}
var arcMetadata;
(function () {
  function a() {
    this.defaults_ = {
      allowEmptyActivityStack: !1,
      apkList: [],
      disableAutoBackButton: !1,
      enableAccessibility: !1,
      enableAdb: !1,
      enableArcStrace: !1,
      enableCompositor: !1,
      enableExternalDirectory: !1,
      enableGlErrorCheck: !1,
      disableGlFixedAttribs: !1,
      enableSynthesizeTouchEventsOnWheel: !0,
      formFactor: "phone",
      fpsLimit: 60,
      isSlowDebugRun: !1,
      jdbPort: 0,
      jsFullTestList: [],
      jsTestFilter: "*",
      logLoadProgress: !1,
      minimumLaunchDelay: 0,
      name: "",
      ndkAbi: "",
      orientation: "portrait",
      packageName: "org.chromium.arc",
      javaTraceStartup: 0,
      resize: "disabled",
      shell: [],
      stderrLog: "S",
      useGoogleContactsSyncAdapter: !1,
      usePlayServices: [],
      sleepOnBlur: !0
    };
    this.data_ = {};
    this.computedValues_ = {};
    if (chrome.runtime && chrome.runtime.getManifest) {
      var a = chrome.runtime.getManifest();
      this.data_ = a.arc_metadata || {};
      this.validateData_();
      this.computeValues_(a)
    }
  }

  a.prototype.get = function () {
    var a = {}, c;
    for (c in this.defaults_)this.defaults_.hasOwnProperty(c) && (this.data_.hasOwnProperty(c) ? a[c] = this.data_[c] : a[c] = this.defaults_[c]);
    return this.addComputedValues_(a)
  };
  a.prototype.getValue = function (a) {
    if (this.data_.hasOwnProperty(a))return this.data_[a];
    if (this.computedValues_.hasOwnProperty(a))return this.computedValues_[a];
    if (this.defaults_.hasOwnProperty(a))return this.defaults_[a];
    throw"unknown arc_metadata param: " + a;
  };
  a.prototype.validateData_ = function () {
    for (var a in this.data_)if (this.data_.hasOwnProperty(a) && (this.defaults_.hasOwnProperty(a) ? typeof this.data_[a] !== typeof this.defaults_[a] && (console.error('Type mismatch of "' + a + '" in ARC metadata'), console.group(),
        console.error("Default type: " + typeof this.defaults_[a]), console.error("Current type: " + typeof this.data_[a]), console.groupEnd()) : console.error('Unknown property "' + a + '" in ARC metadata')), a in _ALLOWED_VALUES_MAP) {
      var c = this.data_[a], d = _ALLOWED_VALUES_MAP[a];
      -1 == d.indexOf(c) && (console.group(), console.error("Invalid value of " + a + ": " + c), console.error("It must be one of: " + d.join(", ")), console.groupEnd())
    }
  };
  a.prototype.getAndroidDensityDpi_ = function (a, c) {
    var d = [120, 160, 213, 240, 320, 400, 480, 640], e =
      160 * c;
    "phone" != a && (e *= 0.75);
    var f = d.map(function (a) {
      return Math.abs(a - e)
    }), f = f.indexOf(Math.min.apply(Math, f));
    return d[f]
  };
  a.prototype.computeWindowSizeInChromeDips_ = function (a, c) {
    var d = this.getAndroidDensityDpi_(a, c);
    shortChromeDip = Math.ceil(_TARGET_ANDROID_DP[a].short * (d / 160) / c);
    longChromeDip = Math.ceil(_TARGET_ANDROID_DP[a].long * (d / 160) / c);
    return {"short": shortChromeDip, "long": longChromeDip, androidDensityDpi: d}
  };
  a.prototype.computeValues_ = function (a) {
    var c = window.devicePixelRatio / getCurrentZoom(),
      d = this.getValue("formFactor"), e;
    "maximized" == d ? (a = screen.availWidth, e = screen.availHeight - _TOPBAR_HEIGHT, c = this.getAndroidDensityDpi_(d, c)) : (c = this.computeWindowSizeInChromeDips_(d, c), "landscape" == this.getValue("orientation") ? (a = c.long, e = c.short) : (a = c.short, e = c.long), c = c.androidDensityDpi);
    this.computedValues_.width = a;
    this.computedValues_.height = e;
    this.computedValues_.androidDensityDpi = c;
    c = !1;
    a <= screen.availHeight - _TOPBAR_HEIGHT && e <= screen.availWidth && (c = !0);
    this.computedValues_.canRotate = c
  };
  a.prototype.addComputedValues_ =
    function (a) {
      for (var c in this.computedValues_)this.computedValues_.hasOwnProperty(c) && (a[c] = this.computedValues_[c]);
      return a
    };
  arcMetadata = new a
})();
function getRuntimeID() {
  return chrome.runtime.getManifest()["import"][0].id
}
function getRuntimeManifestURL() {
  var a = getRuntimeID();
  return chrome.runtime.getURL("/_modules/" + a + "/manifest.json")
}
function requestRuntimeManifest() {
  if (null !== _common.cachedRuntimeManifestPromise)return _common.cachedRuntimeManifestPromise;
  var a = getRuntimeManifestURL();
  _common.cachedRuntimeManifestPromise = PromiseWrap.xmlHttpRequest("GET", a).then(JSON.parse);
  return _common.cachedRuntimeManifestPromise
}
function getManifestItem(a, b, c) {
  return a.hasOwnProperty(b) ? a[b] : c
}
function getBuildTagFromManifest(a) {
  return getManifestItem(a, "arc_build_tag", "unknown")
}
function isManifestCWSInstalled(a) {
  a = getManifestItem(a, "update_url", "");
  var b = document.createElement("a");
  b.href = a;
  return "clients2.google.com" == b.host && "/service/update2/crx" == b.pathname ? !0 : !1
}
function isAppCwsInstalled() {
  var a = chrome.runtime.getManifest();
  return isManifestCWSInstalled(a)
}
function getRuntimeCwsInstalled() {
  return new Promise(function (a, b) {
    requestRuntimeManifest().then(function (b) {
      a(isManifestCWSInstalled(b))
    })
  })
}
function shouldSendCrashReports() {
  return new Promise(function (a, b) {
    requestRuntimeManifest().then(function (b) {
      null != getBuildTagFromManifest(b).match(/^arc-runtime-\d+\.\d+\.\d+\.\d+$/) ? a(!0) : a(!1)
    })
  })
}
function applyPromise(a, b) {
  return Promise.all(a).then(function (a) {
    return b.apply(null, a)
  })
}
function PromiseBridge(a) {
  this.fullfilled = !1;
  this.fullfilledValue = null;
  this.rejected = !1;
  this.rejectedValue = null;
  this.resolveCallbacks = [];
  this.rejectCallbacks = [];
  var b = this;
  a.then(function (a) {
    b.fullfilled = !0;
    b.fullfilledValue = a;
    var d = b.resolveCallbacks;
    b.resolveCallbacks = [];
    b.rejectCallbacks = [];
    for (var e = 0; e < d.length; ++e)d[e](a)
  }, function (a) {
    b.rejected = !0;
    b.rejectedValue = a;
    var d = b.rejectCallbacks;
    b.resolveCallbacks = [];
    b.rejectCallbacks = [];
    for (var e = 0; e < d.length; ++e)d[e](a)
  })
}
PromiseBridge.createPromise = function (a) {
  return new Promise(function (b, c) {
    a.fullfilled ? b(a.fullfilledValue) : a.rejected ? c(a.rejectedValue) : (a.resolveCallbacks.push(b), a.rejectCallbacks.push(c))
  })
};
function AccessibilityManager(a) {
  this.plugin_ = a;
  a.addMessageListener("jsAccessibility", this.handleMessage.bind(this))
}
AccessibilityManager.prototype.ID_PREFIX_ = "accessibility";
AccessibilityManager.prototype.ROOT_NODE_ID_ = "accessibility-root";
AccessibilityManager.prototype.handleMessage = function (a) {
  if ("setViewHierarchy" !== a.command)console.error("Unknown command received in AccessibilityManager:" + a.command); else {
    a = a.data;
    a = this.convertTreeToHtml_(a.accessibilityNodeHierarchy, a.windowId);
    a.id = this.ROOT_NODE_ID_;
    var b = "";
    null !== document.activeElement && (b = document.activeElement.id);
    var c = document.getElementById(this.ROOT_NODE_ID_);
    null !== c && c.remove();
    document.body.appendChild(a);
    0 === b.indexOf(this.ID_PREFIX_) && (a = document.getElementById(b),
    null !== a && a.focus())
  }
};
AccessibilityManager.prototype.convertTreeToHtml_ = function (a, b) {
  var c = this.convertNodeToHtml_(a, b), d = a.children;
  if (void 0 !== d)for (var e = 0; e < d.length; e++)childDiv = this.convertTreeToHtml_(d[e], b), c.appendChild(childDiv);
  return c
};
AccessibilityManager.prototype.sendClickEvent_ = function (a, b) {
  this.plugin_.postMessage({
    namespace: "androidAccessibility",
    command: "performAction",
    data: {eventType: "click", windowId: a, nodeId: b}
  })
};
AccessibilityManager.prototype.convertNodeToHtml_ = function (a, b) {
  var c;
  a.clickable ? (c = document.createElement("button"), c.onclick = this.sendClickEvent_.bind(this, b, a.nodeId)) : c = document.createElement("div");
  c.id = this.ID_PREFIX_ + a.nodeId;
  var d = a.text;
  void 0 !== d && "" !== d && (d = document.createTextNode(d), c.appendChild(d));
  c.style.setProperty("left", a.left + "px");
  c.style.setProperty("top", a.top + _TOPBAR_HEIGHT + "px");
  d = a.bottom - a.top;
  c.style.setProperty("width", a.right - a.left + "px");
  c.style.setProperty("height",
    d + "px");
  return c
};
var childPlugins = [];
function ChildPlugin(a, b, c, d, e) {
  this.active = !0;
  this.args_ = b.args;
  this.backgroundPage_ = null;
  this.command_ = b.plugin;
  this.container_ = a;
  this.currentWorkingDirectory_ = b.currentworkingdirectory;
  this.envs_ = b.envs;
  this.handleExitMessage_ = c;
  this.handleStderrMessage_ = e;
  this.handleStdoutMessage_ = d;
  this.loaded_ = !1;
  this.plugin_ = null;
  this.preopened_fd_args_ = b.preopened_fd_args;
  this.preopened_fd_names_ = b.preopened_fd_names;
  this.requestId_ = b.requestId;
  this.requester_ = b.requester;
  this.timeoutId_ = null;
  this.timeout_ =
    2;
  this.create_()
}
ChildPlugin.prototype.create_ = function () {
  var a = arcMetadata.get();
  this.plugin_ = document.createElement("embed");
  var b = getRuntimeID();
  this.plugin_.setAttribute("src", "/_modules/" + b + "/arc.nmf");
  this.plugin_.setAttribute("type", "application/x-nacl");
  this.plugin_.setAttribute("plugintype", this.command_);
  this.currentWorkingDirectory_ && this.plugin_.setAttribute("current_working_directory", this.currentWorkingDirectory_);
  this.plugin_.setAttribute("args", this.args_.join(_STRING_DELIMITER));
  this.envs_ && this.plugin_.setAttribute("envs",
    this.envs_.join(_STRING_DELIMITER));
  this.preopened_fd_args_ && this.preopened_fd_names_ && (this.plugin_.setAttribute("preopened_fd_args", this.preopened_fd_args_.join(_STRING_DELIMITER)), this.plugin_.setAttribute("preopened_fd_names", this.preopened_fd_names_.join(_STRING_DELIMITER)));
  this.plugin_.setAttribute("request_id", this.requestId_);
  this.plugin_.setAttribute("requester", this.requester_);
  this.plugin_.setAttribute("width", 0);
  this.plugin_.setAttribute("height", 0);
  this.plugin_.setAttribute("packagename",
    a.packageName);
  this.plugin_.setAttribute("stderrlog", a.stderrLog);
  this.plugin_.setAttribute("enablearcstrace", a.enableArcStrace);
  this.plugin_.setAttribute("timezone", getTimeZone());
  a = getLocale();
  this.plugin_.setAttribute("language", a.language);
  a.country && this.plugin_.setAttribute("country", a.country);
  (this.handleStderrMessage_ || this.handleStdoutMessage_) && this.plugin_.setAttribute("enable_stdio_bridge", !0);
  var c = this;
  getRuntimeCwsInstalled().then(function (a) {
    a || c.plugin_.setAttribute("enable_ndk_executable",
      !0);
    console.time("ChildPlugin " + c.requester_ + ":" + c.requestId_ + ":" + c.args_[0] + "(" + c.command_ + ") Run");
    c.container_.appendChild(c.plugin_);
    c.plugin_.addEventListener("message", c.handleMessageEvent_.bind(c), !1);
    c.plugin_.addEventListener("crash", function (a) {
      c.postExitMessage_(c.createExitMessage_(-1), "Plugin process crashed")
    }, !1);
    c.timeoutId_ = setTimeout(function () {
      c.timeoutId_ = null;
      if (!c.loaded_) {
        var a = c.container_;
        c.remove("timeout to spawn ChildPlugin process: " + c.args_[0] + "(" + c.command_ + "), " + c.args_.join(" "));
        32 <= c.timeout_ ? (console.error("give up to spawn ChildPlugin process."), c.postExitMessage_(c.createExitMessage_(-1))) : (c.timeout_ *= 2, console.log("retry to spawn with timeout " + c.timeout_ + "sec."), c.active = !0, c.container_ = a, c.create_())
      }
    }, 1E3 * c.timeout_)
  });
  this.backgroundPage_ = window.arc ? window.arc.backgroundPage : window
};
ChildPlugin.prototype.handleMessageEvent_ = function (a) {
  if (this.active)if (a = a.data, a.constructor == ArrayBuffer)this.backgroundPage_.crashReporter.reportCrash("minidump on " + this.command_, a); else {
    if ("jsPlugin" == a.namespace) {
      if ("loadResult" == a.command) {
        a.data.result ? (a = this.command_, 0 < this.args_.length && (a += "/" + this.args_[0]), console.log("the child process has been loaded: " + a), this.loaded_ = !0) : this.remove("Cannot load plugin process");
        return
      }
      if ("crashLogMessage" == a.command)return
    }
    "jsChildplugin" != a.namespace ?
      this.remove('Received invalid namespace message. Namespace: "' + a.namespace + '", Command: "' + a.command + '"') : "spawn" == a.command ? ChildPlugin.handleChildPluginMessage(a, this.plugin_.postMessage.bind(this.plugin_), this.handleStdoutMessage_, this.handleStderrMessage_) : "stdout" == a.command ? (a.namespace = this.requester_, this.handleStdoutMessage_ && this.handleStdoutMessage_(a)) : "stderr" == a.command ? (a.namespace = this.requester_, this.handleStderrMessage_ && this.handleStderrMessage_(a)) : "exit" == a.command ? (a.namespace =
      this.requester_, this.postExitMessage_(a)) : this.remove("Received unknown childplugin command: " + a.command)
  }
};
ChildPlugin.prototype.postExitMessage_ = function (a, b) {
  this.remove(b) && this.handleExitMessage_(a)
};
ChildPlugin.prototype.createExitMessage_ = function (a) {
  return {namespace: this.requester_, command: "exit", data: {requestId: this.requestId_, result: a}}
};
ChildPlugin.prototype.remove = function (a) {
  if (!this.active)return !1;
  this.active = !1;
  this.timeoutId_ && (clearTimeout(this.timeoutId_), this.timeoutId_ = null);
  console.timeEnd("ChildPlugin " + this.requester_ + ":" + this.requestId_ + ":" + this.args_[0] + "(" + this.command_ + ") Run");
  a && console.log(a);
  this.container_.removeChild(this.plugin_);
  this.plugin_ = this.container_ = null;
  childPlugins = childPlugins.filter(function (a) {
    a != this
  });
  return !0
};
ChildPlugin.handleChildPluginMessage = function (a, b, c, d) {
  "spawn" == a.command ? childPlugins.push(new ChildPlugin(document.getElementById("appdiv"), a.data, b, c, d)) : (console.log("Received unknown childplugin message: "), console.log(a))
};
var PromiseWrap = {
  chooseEntry: function (a) {
    return new Promise(function (b, c) {
      chrome.fileSystem.chooseEntry(a, function (a) {
        chrome.runtime.lastError ? c(chrome.runtime.lastError) : a ? b(a) : c(Error("User cancelled"))
      })
    })
  }, isFilesystemRestorable: function (a) {
    return new Promise(function (b, c) {
      chrome.fileSystem.isRestorable(a, function (d) {
        d ? b(a) : c(Error("The filesystem is not restorable."))
      })
    })
  }, restoreFilesystem: function (a) {
    return new Promise(function (b, c) {
      chrome.fileSystem.restoreEntry(a, function (a) {
        a ? b(a) : c(Error(chrome.runtime.lastError.message))
      })
    })
  },
  getAuthToken: function (a) {
    return new Promise(function (b, c) {
      chrome.identity.getAuthToken(a, function (a) {
        chrome.runtime.lastError ? c(Error(chrome.runtime.lastError.message)) : b(a)
      })
    })
  }, getPlatformInfo: function () {
    return new Promise(function (a, b) {
      chrome.runtime.getPlatformInfo(function (b) {
        a(b)
      })
    })
  }, getProfileUserInfo: function () {
    return new Promise(function (a, b) {
      chrome.identity && chrome.identity.getProfileUserInfo ? chrome.identity.getProfileUserInfo(function (c) {
        chrome.runtime.lastError ? b(Error(chrome.runtime.lastError.message)) :
          a(c)
      }) : b(Error("chrome.identity.getProfileUserInfo is unavailable. Please make sure your Chrome is at least M37."))
    })
  }, removeCachedAuthToken: function (a) {
    return new Promise(function (b, c) {
      chrome.identity.removeCachedAuthToken(a, function () {
        chrome.runtime.lastError ? c(Error(chrome.runtime.lastError.message)) : b()
      })
    })
  }, getLocalStorageValue: function (a) {
    return new Promise(function (b, c) {
      chrome.storage.local.get(a, function (d) {
        d.hasOwnProperty(a) ? b(d[a]) : (chrome.runtime.lastError && console.error("Error on reading local storage, continue anyway: " +
        chrome.runtime.lastError.message), c(Error("There is no retained filesystem key.")))
      })
    })
  }, setLocalStorageValue: function (a) {
    return new Promise(function (b, c) {
      chrome.storage.local.set(a, function (a) {
        chrome.runtime.lastError ? c(Error("Cannot save email to local storage: " + chrome.runtime.lastError.message)) : b()
      })
    })
  }, requestFileSystem: function (a) {
    return new Promise(function (b, c) {
      window.webkitRequestFileSystem(a, 1, function (a) {
        b(a)
      }, function (a) {
        c(Error(a))
      })
    })
  }, requestFileSystemRoot: function (a) {
    return PromiseWrap.requestFileSystem(a).then(function (a) {
      return a.root
    })
  },
  xmlHttpRequest: function (a, b, c) {
    void 0 == c && (c = "text");
    return new Promise(function (d, e) {
      var f = new XMLHttpRequest;
      f.open(a, b, !0);
      f.responseType = c;
      f.onreadystatechange = function () {
        try {
          4 == f.readyState && (200 == f.status ? d(f.response) : e(Error(f.response)))
        } catch (a) {
          e(Error(a))
        }
      };
      f.send()
    })
  }, getDirectory: function (a, b, c) {
    return new Promise(function (d, e) {
      a.getDirectory(b, c, function (a) {
        d(a)
      }, function (a) {
        e(Error(a))
      })
    })
  }, getFile: function (a, b, c) {
    return new Promise(function (d, e) {
      a.getFile(b, c, function (a) {
        d(a)
      }, function (a) {
        e(Error(a))
      })
    })
  },
  getMetadata: function (a) {
    return new Promise(function (b, c) {
      a.getMetadata(function (a) {
        b(a)
      }, function (a) {
        c(Error(a))
      })
    })
  }, readEntries: function (a) {
    var b = a.createReader(), c = [];
    return new Promise(function (a, e) {
      var f = function () {
        b.readEntries(function (b) {
          0 === b.length ? a(Array.prototype.concat.apply([], c)) : (c.push(b), f())
        }, function (a) {
          e(Error(a))
        })
      };
      f()
    })
  }, removeEntryRecursively: function (a) {
    return new Promise(function (b, c) {
      a.isDirectory ? a.removeRecursively(function () {
        b()
      }, function (a) {
        c(Error(a))
      }) : a.remove(function () {
          b()
        },
        function (a) {
          c(Error(a))
        })
    })
  }, moveTo: function (a, b, c) {
    return new Promise(function (d, e) {
      a.moveTo(b, c, function (a) {
        d(a)
      }, function (a) {
        e(Error(a))
      })
    })
  }, createWriter: function (a) {
    return new Promise(function (b, c) {
      a.createWriter(function (a) {
        b(a)
      }, function (a) {
        c(Error(a))
      })
    })
  }, truncate: function (a, b) {
    return new Promise(function (c, d) {
      a.readyState === a.WRITING ? d(Error(new DOMError("InvalidStateError"))) : (a.onwrite = function () {
        a.onwrite = null;
        a.onerror = null;
        c(a)
      }, a.onerror = function (b) {
        a.onwrite = null;
        a.onerror = null;
        d(Error(b))
      },
        a.truncate(b))
    })
  }, write: function (a, b) {
    return new Promise(function (c, d) {
      a.readyState === a.WRITING ? d(Error(new DOMError("InvalidStateError"))) : (a.onwrite = function (b) {
        a.onwrite = null;
        a.onerror = null;
        c(a)
      }, a.onerror = function (b) {
        a.onwrite = null;
        a.onerror = null;
        d(Error(b))
      }, a.write(b))
    })
  }, file: function (a) {
    return new Promise(function (b, c) {
      a.file(function (a) {
        b(a)
      }, function (a) {
        c(Error(a))
      })
    })
  }, readBlobAsText: function (a) {
    return new Promise(function (b, c) {
      var d = new FileReader;
      d.onload = function () {
        b(d.result)
      };
      d.onerror =
        function () {
          c(Error(d.error))
        };
      d.readAsText(a)
    })
  }
};
function AuthManager(a) {
  this.plugin_ = a;
  a.addMessageListener("jsChromeIdentity", this.handleAuthMessage_.bind(this))
}
AuthManager.prototype.parseScope_ = function (a) {
  return a && 0 == a.indexOf("oauth2:") && 0 > a.indexOf(":server:client_id:") ? a.substring(7).split(" ") : []
};
AuthManager.prototype.handleGetAuthToken_ = function (a) {
  console.log("Authentication requested", a);
  var b = function (a) {
    this.plugin_.postMessage({namespace: "androidIdentity", command: "getAuthTokenResponse", data: a})
  }.bind(this), c = {interactive: !0};
  a = this.parseScope_(a.data.tokenType);
  0 < a.length && (c.scopes = a);
  PromiseWrap.getAuthToken(c).then(function (a) {
    console.log("Authentication successful");
    b({token: a})
  }, function (a) {
    console.error("Authentication error", a);
    b({error: a.message})
  })
};
AuthManager.prototype.handleInvalidateAuthToken_ = function (a) {
  var b = function (a) {
    this.plugin_.postMessage({
      namespace: "androidAccountManagerService",
      command: "invalidateAuthTokenResponse",
      data: a
    })
  }.bind(this), c = a.data.token;
  PromiseWrap.removeCachedAuthToken({token: c}).then(function () {
    console.log("Removed cached auth token", c);
    b({})
  }, function (a) {
    console.error("Error occurred when removing auth token", a);
    b({error: a.message})
  })
};
AuthManager.prototype.handleAuthMessage_ = function (a) {
  "getAuthToken" == a.command ? this.handleGetAuthToken_(a) : "invalidateAuthToken" == a.command && this.handleInvalidateAuthToken_(a)
};
var _FS_INIT_CALLBACK_COUNT = 2;
function FileSystemManager(a, b) {
  this.plugin_ = a;
  this.callbacks_ = [];
  this.fileSystemInitCallbackCount_ = 0;
  this.onInitializedCallback_ = b;
  this.retainedExternalFileSystemKey_ = "retainedExternalFileSystemKey";
  this.prefetchedMetadata_ = [];
  this.externalFiles_ = null;
  this.mountedExternalFilesKey_ = "mountedExternalFiles";
  var c = this;
  a.addMessageListener("jsFileSystem", function (a) {
    c.handleMessage_(a)
  });
  "loading" == document.readyState ? document.addEventListener("DOMContentLoaded", this.prefetchFileSystemMetadata_.bind(this)) : this.prefetchFileSystemMetadata_();
  a.addAppPluginReadyCallback(function () {
    c.postFileSystemReadyMessageIfNeeded()
  })
}
FileSystemManager.prototype.prefetchFileMetadata_ = function (a) {
  var b = this, c = "/data/data/com.android.settings/files/wallpaper /data/local.prop /data/security/mac_permissions.xml /data/system/accounts.db /data/system/appops.xml /data/system/appops.xml.bak /data/system/called_pre_boots.dat /data/system/devices/idc/PPAPI_Keyboard.idc /data/system/devices/keychars/PPAPI_Keyboard.kcm /data/system/devices/keylayout/Virtual.kl /data/system/display_settings.xml /data/system/display_settings.xml.bak /data/system/inputmethod/subtypes.xml /data/system/inputmethod/subtypes.xml.bak /data/system/notification_policy.xml /data/system/notification_policy.xml.bak /data/system/packages-backup.xml /data/system/packages-compat.xml /data/system/packages-compat.xml.bak /data/system/packages-stopped-backup.xml /data/system/packages-stopped.xml /data/system/packages.list /data/system/packages.xml /data/system/registered_services/android.accounts.AccountAuthenticator.xml /data/system/registered_services/android.accounts.AccountAuthenticator.xml.bak /data/system/registered_services/android.content.SyncAdapter.xml /data/system/sync/accounts.xml /data/system/sync/accounts.xml.bak /data/system/sync/pending.bin /data/system/sync/pending.xml /data/system/sync/pending.xml.bak /data/system/sync/stats.bin /data/system/sync/stats.bin.bak /data/system/sync/status.bin /data/system/sync/status.bin.bak /data/system/syncmanager.db /data/system/urigrants.xml /data/system/urigrants.xml.bak /data/system/usagestats/usage-history.xml /data/system/users/0.xml /data/system/users/0.xml.bak /data/system/users/0/accounts.db /data/system/users/0/accounts.db-journal /data/system/users/0/accounts.db-wal /data/system/users/0/package-restrictions-backup.xml /data/system/users/0/package-restrictions.xml /data/system/users/0/wallpaper /data/system/users/0/wallpaper_info.xml /data/system/users/0/wallpaper_info.xml.tmp /data/system/users/userlist.xml /data/system/users/userlist.xml.bak /data/system/wallpaper_info.xml".split(" ").map(function (c) {
    var e;
    return PromiseWrap.getFile(a.root,
      c, {create: !1}).then(function (a) {
        e = a;
        return PromiseWrap.getMetadata(a)
      }).then(function (a) {
        a = {
          fullPath: e.fullPath,
          exists: !0,
          isFile: e.isFile,
          mtime_ms: String(a.modificationTime.getTime()),
          size: String(a.size)
        };
        b.prefetchedMetadata_.push(a)
      }, function (a) {
        b.prefetchedMetadata_.push({fullPath: c, exists: !1})
      })
  }), c = Promise.all(c);
  c.catch(function (a) {
    console.error(a)
  });
  return c
};
FileSystemManager.prototype.prefetchFileSystemMetadata_ = function (a, b) {
  console.time("ARC HTML5 FS: Request FileSystem");
  var c, d = this;
  return PromiseWrap.requestFileSystem(PERSISTENT).then(function (a) {
    console.timeEnd("ARC HTML5 FS: Request FileSystem");
    c = a
  }).then(function () {
    return window.arc.systemDirectoriesReady
  }).then(function (a) {
    d.prefetchedMetadata_ = d.prefetchedMetadata_.concat(a);
    d.postFileSystemReadyMessageIfNeeded() || (console.time("ARC HTML5 FS: prefetchFileMetadata_"), d.prefetchFileMetadata_(c).then(function () {
      console.timeEnd("ARC HTML5 FS: prefetchFileMetadata_")
    }))
  })
};
FileSystemManager.prototype.postMessage_ = function (a, b, c) {
  this.plugin_.postMessage({namespace: a, command: b, data: c})
};
FileSystemManager.prototype.getExternalFiles_ = function () {
  return this.externalFiles_ ? this.externalFiles_ : this.externalFiles_ = PromiseWrap.getLocalStorageValue(this.mountedExternalFilesKey_).then(function (a) {
    a = JSON.parse(a);
    return a ? a : (console.error("Error! Cannot restore external files. Invalid value for " + itemstr), {})
  }, function (a) {
    return {}
  })
};
FileSystemManager.prototype.saveExternalFiles_ = function (a) {
  var b = {};
  b[this.mountedExternalFilesKey_] = JSON.stringify(a);
  chrome.storage.local.set(b);
  this.externalFiles_ = Promise.resolve(a)
};
FileSystemManager.prototype.postMessageAndReply_ = function (a, b, c) {
  var d = this;
  return new Promise(function (e, f) {
    d.callbacks_.push(function (a) {
      e(a)
    });
    d.postMessage_(a, b, {messageId: d.callbacks_.length - 1, info: c})
  })
};
FileSystemManager.prototype.updateExtDirButtonVisibility_ = function (a) {
  document.getElementById("extdir-button").className = a ? "button" : "hiddenbutton"
};
FileSystemManager.prototype.handleMessage_ = function (a) {
  void 0 != a.data.messageId && a.data.messageId < this.callbacks_.length ? (this.callbacks_[a.data.messageId](a.data), this.callbacks_[a.data.messageId] = null) : "openExternalFile" == a.command ? this.handleOpenExternalFileMessage_(a.data) : "openExternalDirectory" == a.command ? this.handleOpenExternalDirectoryMessage_() : "requestFileFromFileHandler" == a.command ? this.handleRequestFileFromFileHandler_() : "mountExternalFileCall" == a.command && this.handleMountExternalFile_(a.data)
};
FileSystemManager.prototype.sendMountExtDirMessage_ = function (a, b) {
  this.postMessageAndReply_("pluginFileSystemManager", "mountExternalDirectory", {
    fileSystem: a,
    fullPath: b,
    writable: !0
  })
};
FileSystemManager.prototype.handleOpenExternalDirectoryMessage_ = function () {
  console.assert(this.plugin_.getMetadata().enableExternalDirectory);
  var a = this;
  PromiseWrap.getLocalStorageValue(a.retainedExternalFileSystemKey_).then(function (a) {
    return PromiseWrap.isFilesystemRestorable(a)
  }).then(function (a) {
    return PromiseWrap.restoreFilesystem(a)
  }).then(function (b) {
    a.sendMountExtDirMessage_(b.filesystem, b.fullPath);
    a.updateExtDirButtonVisibility_(!0)
  }, function (b) {
    a.openAndMountExternalDirectory(!1)
  })
};
FileSystemManager.prototype.postFileSystemReadyMessageIfNeeded = function () {
  this.fileSystemInitCallbackCount_++;
  console.log("File system initialization " + this.fileSystemInitCallbackCount_ + "/" + _FS_INIT_CALLBACK_COUNT);
  if (this.fileSystemInitCallbackCount_ == _FS_INIT_CALLBACK_COUNT)console.log("Sending " + this.prefetchedMetadata_.length + " file system cache entries to the plugin"), this.postMessage_("pluginFileSystemManager", "ready", {value: this.prefetchedMetadata_}); else if (this.fileSystemInitCallbackCount_ ==
    _FS_INIT_CALLBACK_COUNT - 1)this.onInitializedCallback_();
  return this.fileSystemInitCallbackCount_ == _FS_INIT_CALLBACK_COUNT
};
FileSystemManager.prototype.openAndMountExternalDirectory = function (a) {
  if (this.plugin_.getMetadata().enableExternalDirectory) {
    var b = this;
    PromiseWrap.chooseEntry({type: "openDirectory"}).then(function (c) {
      a && b.postMessage_("pluginFileSystemManager", "resetExternalDirectory", {});
      b.sendMountExtDirMessage_(c.filesystem, c.fullPath);
      b.updateExtDirButtonVisibility_(!0);
      var d = {};
      d[b.retainedExternalFileSystemKey_] = chrome.fileSystem.retainEntry(c);
      chrome.storage.local.set(d, function () {
      })
    }, function (a) {
      if ("User cancelled" !=
        a.message)throw a;
    })
  }
};
FileSystemManager.prototype.handleOpenExternalFileMessage_ = function (a) {
  var b = {type: a.type.valueOf()};
  "openFile" == a.type ? b.accepts = [{mimeTypes: a.acceptTypes.valueOf()}] : b.suggestedName = a.suggestedName.valueOf();
  var c = this, d = null, e = null, f = !1;
  PromiseWrap.chooseEntry(b).then(function (b) {
    d = b;
    f = "saveFile" == a.type;
    b = {fileSystem: d.filesystem, fullPath: d.fullPath, writable: f};
    e = chrome.fileSystem.retainEntry(d);
    return c.postMessageAndReply_("pluginFileSystemManager", "mountExternalFile", b)
  }).then(function (b) {
    var d =
      b.info.mountPoint;
    c.getExternalFiles_().then(function (a) {
      a[d] = {retainKey: e, writable: f};
      c.saveExternalFiles_(a)
    });
    c.postMessage_(a.requester, "openExternalFileResponse", {result: !0, path: d})
  }, function (b) {
    "User cancelled" != b.message && console.error(b);
    c.postMessage_(a.requester, "openExternalFileResponse", {result: !1})
  })
};
FileSystemManager.prototype.handleRequestFileFromFileHandler_ = function () {
  var a = window.arc.launchArgs.items;
  if (a && a.length) {
    var b = a[0].entry, c = a[0].type, d = this;
    d.postMessageAndReply_("pluginFileSystemManager", "mountExternalFile", {
      fileSystem: b.filesystem,
      fullPath: b.fullPath,
      writable: !0
    }).then(function (a) {
      d.postMessage_("androidFileHandler", "requestFileFromFileHandlerResponse", {
        result: !0,
        path: a.info.mountPoint,
        mimeType: c
      })
    }, function (a) {
      console.error(a);
      d.postMessage_("androidFileHandler", "requestFileFromFileHandlerResponse",
        {result: !1})
    })
  }
};
FileSystemManager.prototype.handleMountExternalFile_ = function (a) {
  var b = this, c = a.requester, d = {requestId: a.requestId, result: !1}, e;
  b.getExternalFiles_().then(function (f) {
    if ((e = f[a.path]) && e.retainKey)return PromiseWrap.isFilesystemRestorable(e.retainKey);
    d.error = "Does not exist";
    b.postMessage_(c, "rpcReturn", d)
  }).then(function (a) {
    return PromiseWrap.restoreFilesystem(a)
  }).then(function (a) {
    var g = {};
    g.fileSystem = a.filesystem;
    g.fullPath = a.fullPath;
    g.writable = e.writable;
    d.messageId = 0;
    d.result = !0;
    d.info = g;
    b.postMessage_(c, "rpcReturn", d)
  }, function (f) {
    console.warn("Warning! Data to restore entry for path " + a.path + "(" + e.retainKey + ") no longer exists");
    d.error = "Is not restorable";
    b.postMessage_(c, "rpcReturn", d)
  })
};
function GeoLocationManager(a) {
  this.plugin_ = a;
  this.timer_ = this.interval_ = 0;
  a.addMessageListener("jsGeolocation", this.handleMessage_.bind(this))
}
GeoLocationManager.prototype.updatePosition_ = function (a) {
  0 != this.interval_ && (this.plugin_.postMessage({
    namespace: "androidGeolocation",
    command: "report",
    data: {
      latitude: a.coords.latitude,
      longitude: a.coords.longitude,
      accuracy: a.coords.accuracy,
      timestamp: a.timestamp
    }
  }), this.timer_ = setTimeout(this.requestPosition_.bind(this), this.interval_))
};
GeoLocationManager.prototype.reportError_ = function (a) {
  if (0 != this.interval_) {
    var b = 0;
    switch (a.code) {
      case a.PERMISSION_DENIED:
        a = "Permission denied: " + a.message;
        b = 1;
        break;
      case a.POSITION_UNAVAILABLE:
        a = "Position unavailable: " + a.message;
        break;
      case a.TIMEOUT:
        a = "Request timed out: " + a.message;
        break;
      default:
        a = "Unknown error: " + a + " / " + a.message
    }
    this.plugin_.postMessage({namespace: "androidGeolocation", command: "error", data: {permanent: b, text: a}});
    this.timer_ = setTimeout(this.requestPosition_.bind(this), this.interval_)
  }
};
GeoLocationManager.prototype.requestPosition_ = function (a) {
  navigator.geolocation.getCurrentPosition(this.updatePosition_.bind(this), this.reportError_.bind(this))
};
GeoLocationManager.prototype.startTracking_ = function (a) {
  var b = 0 != this.interval_;
  this.interval_ = 0 < a ? a : 5E3;
  b ? this.timer_ && (clearTimeout(this.timer_), this.timer_ = 0, this.requestPosition_()) : this.requestPosition_()
};
GeoLocationManager.prototype.stopTracking_ = function () {
  this.interval_ = 0;
  0 != this.timer_ && (clearTimeout(this.timer_), this.timer_ = 0)
};
GeoLocationManager.prototype.handleMessage_ = function (a) {
  "start" == a.command ? this.startTracking_(a.data && a.data.interval ? a.data.interval : 0) : "stop" == a.command ? this.stopTracking_() : console.log("Unknown geolocation command[" + a.command + "]")
};
var notifications = chrome.notifications;
function NotificationManager(a) {
  notifications && (this.activeIds_ = {}, this.plugin_ = a, notifications.onClosed.addListener(this.postMessage_.bind(this, "onClosed")), notifications.onClicked.addListener(this.onClicked_.bind(this)), notifications.onButtonClicked.addListener(this.postMessage_.bind(this, "onButtonClicked")), a.addMessageListener("jsNotification", this.handleMessage_.bind(this)))
}
NotificationManager.prototype.onClicked_ = function (a) {
  this.plugin_.showWindow();
  this.postMessage_("onClicked", a, null)
};
NotificationManager.prototype.postMessage_ = function (a, b, c) {
  this.plugin_.postMessage({namespace: "androidNotification", command: a, data: {id: b, extra: c}})
};
NotificationManager.prototype.getOptionsFromMessage_ = function (a) {
  return JSON.parse(JSON.stringify(a.data.notification))
};
NotificationManager.prototype.addNotification_ = function (a) {
  var b = a.data.id.valueOf();
  this.activeIds_[b] = !0;
  a = this.getOptionsFromMessage_(a);
  notifications.create(b, a, function () {
  })
};
NotificationManager.prototype.updateNotification_ = function (a) {
  var b = a.data.id.valueOf();
  a = this.getOptionsFromMessage_(a);
  notifications.update(b, a, function () {
  })
};
NotificationManager.prototype.removeNotification_ = function (a) {
  delete this.activeIds_[a];
  notifications.clear(a, function () {
  })
};
NotificationManager.prototype.destroy = function () {
  var a = [], b;
  for (b in this.activeIds_)a.push(b);
  for (b = 0; b < a.length; ++b)this.removeNotification_(a[b])
};
NotificationManager.prototype.handleMessage_ = function (a) {
  "addNotification" == a.command ? this.addNotification_(a) : "updateNotification" == a.command ? this.updateNotification_(a) : "removeNotification" == a.command ? this.removeNotification_(a.data.id.valueOf()) : console.log("Unknown notification command[" + a.command + "]")
};
function Shell(a) {
  this.plugin_ = a;
  this.nextId_ = 0;
  this.sessions_ = {};
  this.pendingJobs_ = [];
  this.androidReady_ = !1;
  a.addMessageListener("jsShell", this.handleMessage_.bind(this))
}
Shell.prototype.shell = function (a, b, c) {
  var d = this;
  return new Promise(function (e, f) {
    var g = function () {
      var f = d.nextId_++, g = {id_: f, onDataCallback_: b, onClosedCallback_: c};
      g.close = d.close_.bind(d, g);
      d.sessions_[f] = g;
      d.plugin_.postMessage({namespace: "androidShell", command: "open", data: {id: f, commandLine: a}});
      e(g)
    };
    d.androidReady_ ? g() : d.pendingJobs_.push(g)
  })
};
Shell.prototype.close_ = function (a) {
  this.plugin_.postMessage({namespace: "androidShell", command: "close", data: {id: a.id_}})
};
Shell.prototype.handleMessage_ = function (a) {
  console.assert("jsShell" == a.namespace);
  if ("ready" == a.command) {
    this.androidReady_ = !0;
    for (a = 0; a < this.pendingJobs_.length; ++a)this.pendingJobs_[a].call();
    this.pendingJobs_ = []
  } else {
    var b = this.sessions_[a.data.id];
    console.assert(b);
    if ("close" == a.command) {
      if (delete this.sessions_[b.id_], void 0 != b.onClosedCallback_)b.onClosedCallback_(b)
    } else if ("data" == a.command)if (void 0 != b.onDataCallback_)b.onDataCallback_(b, a.data.data); else console.log(a.data.data.valueOf())
  }
};
console.time("ARC JS Init");
var __page_begin_date = new Date, _NACL_HEARTBEAT_PERIOD = 3E4, _HEARTBEAT_STACK_TRACES_TIMEOUT = 3E3, _CRASH_RESTART_THRESHOLD = 1E4, _BOOT_STEP_NO_INIT = 0, _BOOT_STEP_JAVASCRIPT_INITIALIZED = 1, _BOOT_STEP_APP_INSTANCE_STARTED = 2, _BOOT_STEP_PACKAGE_DEXOPTED = 3, _BOOT_STEP_SYSTEM_SERVER_STARTED = 4, _BOOT_STEP_DONE = 5, _MAX_BOOT_STEP = 5, _FILE_HANDLER_LAUNCH_ARG = ["am", "start", "-n", "org.chromium.arc.helper/.FileHandlerLaunchHelperActivity", ";"], _PERF_LOG_PREFIX = "perf: ";
function basename(a) {
  return a.replace(/.*\//g, "")
}
function getUptime() {
  return (new Date).getTime() - __page_begin_date.getTime()
}
function Plugin(a) {
  this.shellCommands_ = [];
  this.videoTrack_ = this.audioTrack_ = null;
  this.backButtonEnabled_ = this.isLoadingApk_ = !1;
  this.backgroundPage_ = null;
  this.cachedRotation_ = this.currentBootStep_ = 0;
  this.crashExtraInformation_ = {};
  this.isWindowInitialized_ = this.initializing_ = this.initialized_ = this.hasSeenOnResume_ = this.crashReportReceived_ = !1;
  this.isFocusedWindow_ = !0;
  this.messageListeners_ = {};
  this.metadata_ = {};
  this.onAppPluginReadyCallbacks_ = [];
  this.reportedShutdown_ = !1;
  this.rotation_ = 0;
  this.previousZoom_ =
    1;
  this.geoLocationManager_ = new GeoLocationManager(this);
  this.accessibilityManager_ = new AccessibilityManager(this);
  this.memoryMapViewer_ = null;
  this.fileSystemManager_ = new FileSystemManager(this, function () {
    this.initialized_ ? this.initializeWindow_() : this.onInitialized_ = self.initializeWindow_.bind(self)
  }.bind(this));
  this.notificationManager_ = new NotificationManager(this);
  this.authManager_ = new AuthManager(this);
  this.shellManager_ = new Shell(this);
  this.appPlugin_ = null;
  this.appPluginReady_ = !1;
  this.times_ =
    a;
  this.topbar_ = this.pressedButton_ = null;
  this.waitingForHeartbeat_ = !1;
  this.heartbeatInterval_ = null;
  this.pluginIsRemoved_ = !1;
  this.addMessageListener("jsChildplugin", this.handleChildPluginMessage_.bind(this));
  this.addMessageListener("jsClipboard", this.handleClipboardMessage_.bind(this));
  this.addMessageListener("jsDisplay", this.handleDisplayMessage_.bind(this));
  this.addMessageListener("jsHeartbeat", this.handleHeartbeatMessage_.bind(this));
  this.addMessageListener("jsBrowser", this.handleBrowserMessage_.bind(this));
  this.addMessageListener("jsSystem", this.handleSystemMessage_.bind(this));
  this.addMessageListener("jsGcm", this.relayGcmMessage_.bind(this));
  this.addMessageListener("mediaStream", this.handleMediaStreamMessage_.bind(this));
  this.addMessageListener("jsIap", this.handleIapMessage_.bind(this));
  "function" == typeof MemoryMapViewer && (console.log("MemoryViewer is enabled."), this.memoryMapViewer_ = new MemoryMapViewer(this));
  this.constructFromMetadata_()
}
Plugin.prototype.init = function () {
  this.initialized_ || (this.initializing_ = !0, this.createAppPlugin_(), chrome.app.window && (chrome.app.window.current().contentWindow.addEventListener("resize", this.onResized_.bind(this)), window.arc.onRelaunched = this.onRelaunched.bind(this)), isAppCwsInstalled() && chrome.runtime.getPlatformInfo(function (a) {
  }.bind(this)), this.backgroundPage_ = window.arc.backgroundPage, this.initializing_ = !1)
};
Plugin.prototype.postMessage = function (a) {
  this.appPluginReady_ ? this.appPlugin_.postMessage(a) : console.error("Plugin not ready")
};
Plugin.prototype.initializeWindow_ = function () {
  this.isWindowInitialized_ || (this.doLayout_(!0), this.showWindow(), this.initializeTopBar_(document.getElementById("topbar")), this.isWindowInitialized_ = !0)
};
Plugin.prototype.addMessageListener = function (a, b) {
  this.messageListeners_[a] ? console.log("Message[" + a + "] already has listener.") : this.messageListeners_[a] = b;
  this.appPluginReady_ && this.postMessage({
    namespace: "pluginJSMessageProxy",
    command: "registerJsNamespaces",
    data: {namespaces: [a]}
  })
};
Plugin.prototype.addAppPluginReadyCallback = function (a) {
  this.appPluginReady_ ? console.error("Plugin is already ready to use") : this.onAppPluginReadyCallbacks_.push(a)
};
Plugin.prototype.shell = function (a, b, c) {
  return this.shellManager_.shell(a, b, c)
};
Plugin.prototype.scheduleUmaOnBackgroundPage_ = function (a, b) {
  isAppCwsInstalled() && chrome.runtime.sendMessage({
    namespace: "jsUma",
    command: "scheduleUma",
    data: {uma_data: a, immediate: b}
  })
};
Plugin.prototype.reportAppShutdown_ = function (a) {
  null != this.heartbeatInterval_ && (clearInterval(this.heartbeatInterval_), this.heartbeatInterval_ = null);
  if (this.backgroundPage_ && !this.reportedShutdown_) {
    this.reportedShutdown_ = !0;
    var b = getUptime();
    this.scheduleUmaOnBackgroundPage_(["bool", "ArcRuntime.ShutdownIsCrash", a, "longtime", "ArcRuntime.Uptime", b, "enumeration", "ArcRuntime.LastBootStep", this.currentBootStep_, _MAX_BOOT_STEP + 1], !0)
  }
};
Plugin.prototype.getApkList_ = function () {
  if (void 0 == this.apkList_ && (this.apkList_ = [], 0 == this.metadata_.apkList.length)) {
    var a = chrome.extension && chrome.extension.getBackgroundPage();
    if (a && a.getStreamURL) {
      this.isLoadingApk_ = !0;
      var a = a.getStreamURL(), b = "/mnt/tmp/" + basename(a) + ".apk", c = new Worker("gen_fsworker.min.js");
      c.onmessage = function (a) {
        if ("Done" == a.data && (this.isLoadingApk_ = !1, this.onLoadingApkCompleted_))this.onLoadingApkCompleted_();
        console.log(a.data)
      }.bind(this);
      c.postMessage({
        quota: FS_QUOTA,
        src: a, dest: b
      });
      this.apkList_.push("'" + b + "'")
    }
  }
  return this.apkList_
};
Plugin.prototype.constructFromMetadata_ = function () {
  this.metadata_ = arcMetadata.get();
  this.shellCommands_ = [];
  for (var a = this.getApkList_(), b = 0; b < a.length; ++b)this.shellCommands_.push("pm", "install ", a[b], ";");
  "org.chromium.arc.system" == this.metadata_.packageName ? this.shellCommands_.push("echo", "Start system mode", ";") : 0 < this.metadata_.shell.length ? this.shellCommands_.push.apply(this.shellCommands_, this.metadata_.shell) : (this.shellCommands_.push("echo", "Start running", ";"), window.arc.launchArgs.items ?
    this.shellCommands_ = this.shellCommands_.concat(_FILE_HANDLER_LAUNCH_ARG) : this.shellCommands_.push("am", "start", "$launch", "--activity-reset-task-if-needed", ";"))
};
Plugin.prototype.onResized_ = function () {
  this.doLayout_(!1)
};
Plugin.prototype.handleAppPluginMessage_ = function (a) {
  var b = this.messageListeners_[a.namespace.valueOf()];
  void 0 != b ? b(a) : (console.log("Received an unknown message:"), console.log(a))
};
Plugin.prototype.handleAppPluginLoadAttempt_ = function (a) {
  this.appPlugin_ = a;
  a.setAttribute("width", this.metadata_.width);
  a.setAttribute("height", this.metadata_.height);
  a.setAttribute("appwidth", this.metadata_.width);
  a.setAttribute("appheight", this.metadata_.height);
  a.setAttribute("ndkabi", this.metadata_.ndkAbi);
  a.setAttribute("packagename", this.metadata_.packageName);
  a.setAttribute("enableaccessibility", this.metadata_.enableAccessibility);
  a.setAttribute("enableadb", this.metadata_.enableAdb.toString());
  a.setAttribute("enablecompositor", this.metadata_.enableCompositor.toString());
  a.setAttribute("useremail", window.arc.userEmail || "");
  a.setAttribute("enableglerrorcheck", this.metadata_.enableGlErrorCheck.toString());
  a.setAttribute("disableglfixedattribs", this.metadata_.disableGlFixedAttribs.toString());
  a.setAttribute("enablesynthesizetoucheventsonwheel", this.metadata_.enableSynthesizeTouchEventsOnWheel.toString());
  a.setAttribute("fpslimit", this.metadata_.fpsLimit.toString());
  a.setAttribute("usegooglecontactssyncadapter",
    this.metadata_.useGoogleContactsSyncAdapter);
  a.setAttribute("useplayservices", this.metadata_.usePlayServices.join(" "));
  a.setAttribute("stderrlog", this.metadata_.stderrLog);
  a.setAttribute("enablearcstrace", this.metadata_.enableArcStrace);
  a.setAttribute("logloadprogress", this.metadata_.logLoadProgress.toString());
  a.setAttribute("shell", this.shellCommands_.join(_STRING_DELIMITER));
  a.setAttribute("jdbport", this.metadata_.jdbPort);
  a.setAttribute("applaunchtime", this.times_.app_launch_time);
  a.setAttribute("embedtime",
    (new Date).getTime());
  a.setAttribute("timezone", getTimeZone());
  a.setAttribute("touchscreen", "ontouchstart"in document.documentElement);
  a.setAttribute("enableexternaldirectory", this.metadata_.enableExternalDirectory);
  a.setAttribute("androiddensitydpi", this.metadata_.androidDensityDpi);
  a.setAttribute("canrotate", this.metadata_.canRotate);
  a.setAttribute("sleepOnBlur", this.metadata_.sleepOnBlur);
  var b = getLocale();
  a.setAttribute("language", b.language);
  b.country && a.setAttribute("country", b.country);
  a.setAttribute("isappcwsinstalled",
    isAppCwsInstalled());
  a.setAttribute("javatracestartup", this.metadata_.javaTraceStartup);
  console.timeEnd("ARC JS Init");
  console.time("ARC Plugin Load");
  a.setAttribute("src", "arc.nmf");
  a.setAttribute("type", "application/x-nacl");
  this.pluginIsRemoved_ && (document.getElementById("appdiv").appendChild(a), this.pluginIsRemoved_ = !1);
  console.log("Compositor is " + (this.metadata_.enableCompositor ? "enabled" : "disabled"));
  this.setBootStep_(_BOOT_STEP_JAVASCRIPT_INITIALIZED);
  this.initialized_ = !0;
  if (this.onInitialized_)this.onInitialized_()
};
Plugin.prototype.handleAppPluginReady_ = function () {
  this.appPluginReady_ = !0;
  var a = Object.keys(this.messageListeners_);
  this.postMessage({namespace: "pluginJSMessageProxy", command: "registerJsNamespaces", data: {namespaces: a}});
  this.pluginFinishedInitTime_ = (new Date).getTime();
  setTimeout(function () {
    this.setBackButtonEnabled_(this.metadata_.disableAutoBackButton)
  }.bind(this), 400);
  this.metadata_.isSlowDebugRun || (this.heartbeatInterval_ = setInterval(this.heartbeat_.bind(this), _NACL_HEARTBEAT_PERIOD));
  this.appPlugin_.focus();
  for (a = 0; a < this.onAppPluginReadyCallbacks_.length; ++a)this.onAppPluginReadyCallbacks_[a]()
};
Plugin.prototype.setBootStep_ = function (a) {
  a > _MAX_BOOT_STEP && (console.error("invalid boot step: " + a), a = _MAX_BOOT_STEP);
  this.currentBootStep_ = a
};
Plugin.prototype.clearSplash_ = function () {
  document.getElementById("splash").className = "hidden-splash"
};
Plugin.prototype.reportCrash_ = function (a, b, c) {
  this.reportAppShutdown_(!0);
  c = c || {};
  var d = chrome.app.window.current();
  d && (c.width = d.getBounds().width, c.height = d.getBounds().height, c.is_minimized = d.isMinimized(), c.is_maximized = d.isMaximized(), c.is_fullscreen = d.isFullscreen());
  c.runtime_updated_while_running = window.arc.runtimeUpdatedWhileRunning;
  for (var e in this.crashExtraInformation_)this.crashExtraInformation_.hasOwnProperty(e) && (c[e] = this.crashExtraInformation_[e]);
  this.crashExtraInformation_ = {};
  this.backgroundPage_.crashReporter.reportCrash(a, b, c);
  isAppCwsInstalled() && (this.closeWindow_(), getUptime() > _CRASH_RESTART_THRESHOLD && (a = {
    namespace: "jsSystem",
    command: "relaunchApp"
  }, chrome.runtime.sendMessage(a)))
};
Plugin.prototype.createAppPlugin_ = function () {
  var a = document.getElementById("app-plugin");
  this.isLoadingApk_ && (document.getElementById("appdiv").removeChild(a), this.pluginIsRemoved_ = !0, a = document.createElement("object"), a.setAttribute("id", "app-plugin"), a.setAttribute("plugintype", "app-plugin"), a.setAttribute("tabindex", "-1"));
  a.addEventListener("message", function (a) {
    a = a.data;
    if (null != a)if (a.constructor == ArrayBuffer)this.crashReportReceived_ = !0, this.showCrash_("plugin crashed: captured minidump"),
      this.reportCrash_("captured minidump", a); else if ("jsPlugin" == a.namespace)if ("loadResult" == a.command)console.timeEnd("ARC Plugin Load"), a.data.result ? this.handleAppPluginReady_() : (this.showCrash_("Plugin failed to load"), this.crashExtraInformation_.sig = "LoadFailure", this.reportCrash_("loadfailure", null)); else if ("logPerfMessage" == a.command) {
      var c = a.data.message;
      a.data.suppression || console.log(c.valueOf());
      -1 != c.indexOf("App instance started") ? this.setBootStep_(_BOOT_STEP_APP_INSTANCE_STARTED) : -1 !=
      c.indexOf("Package dexopted") ? this.setBootStep_(_BOOT_STEP_PACKAGE_DEXOPTED) : -1 != c.indexOf("System server started") ? this.setBootStep_(_BOOT_STEP_SYSTEM_SERVER_STARTED) : -1 == c.indexOf("Activity onResume") || this.hasSeenOnResume_ || (a = ["shorttime", "ArcRuntime.App.OnResumeTime", getUptime()], this.scheduleUmaOnBackgroundPage_(a), this.clearSplash_(), this.setBootStep_(_BOOT_STEP_DONE), this.hasSeenOnResume_ = !0)
    } else if ("crashExtraInformation" == a.command)for (c in a.data)a.data.hasOwnProperty(c) && (this.crashExtraInformation_[c] =
      void 0 === this.crashExtraInformation_[c] ? "" : this.crashExtraInformation_[c] + "\n", this.crashExtraInformation_[c] += a.data[c]); else"reportCrash" == a.command ? (void 0 === this.crashExtraInformation_.sig && (this.crashExtraInformation_.sig = "AndroidUnhandledException"), this.reportCrash_("Android unhandled exception", null)) : (console.log("Unknown plugin message:"), console.log(a)); else this.handleAppPluginMessage_(a)
  }.bind(this), !1);
  a.addEventListener("crash", function (a) {
    this.showCrash_("plugin crashed");
    this.crashReportReceived_ ||
    this.reportCrash_("plugin crash without minidump", null)
  }.bind(this), !1);
  this.isLoadingApk_ ? this.onLoadingApkCompleted_ = function () {
    this.handleAppPluginLoadAttempt_(a)
  }.bind(this) : this.handleAppPluginLoadAttempt_(a)
};
Plugin.prototype.heartbeat_ = function () {
  null != this.appPlugin_ && (this.waitingForHeartbeat_ ? (console.error("PING TIMEOUT: The plugin has not responded to the previous ping request yet, assume it crashed."), this.heartbeatStackTraceTimeout_ = setTimeout(this.heartbeatSendCrash_.bind(this), _HEARTBEAT_STACK_TRACES_TIMEOUT), this.postMessage({
    namespace: "pluginUtil",
    command: "heartbeatStackTrace",
    data: {}
  })) : (this.waitingForHeartbeat_ = !0, this.postMessage({namespace: "androidHeartbeat", command: "ping", data: {}})))
};
Plugin.prototype.heartbeatSendCrash_ = function () {
  this.heartbeatStackTraceTimeout_ && (clearTimeout(this.heartbeatStackTraceTimeout_), this.heartbeatStackTraceTimeout_ = null, this.showCrash_("heartbeat ping timeout"), this.crashExtraInformation_.sig = "HeartbeatTimeout", this.reportCrash_("heartbeat ping timeout", null))
};
Plugin.prototype.removePlugin_ = function () {
  null != this.appPlugin_ && (null != this.heartbeatInterval_ && (clearInterval(this.heartbeatInterval_), this.heartbeatInterval_ = null), document.getElementById("appdiv").removeChild(this.appPlugin_), this.appPlugin_ = null, this.appPluginReady_ = !1)
};
Plugin.prototype.closeWindow_ = function () {
  this.reportAppShutdown_(!1);
  this.removePlugin_();
  this.notificationManager_.destroy();
  this.backgroundPage_.crashReporter.shutDown();
  window.close()
};
Plugin.prototype.showCrash_ = function (a) {
  isAppCwsInstalled() || (this.removePlugin_(), document.getElementById("appdiv").style.background = "black url(sadplugin.png) center no-repeat", this.clearSplash_());
  console.error(a)
};
Plugin.prototype.showNotSupported_ = function () {
  this.removePlugin_();
  this.initializeWindow_();
  this.clearSplash_();
  var a = document.getElementById("errortext"), b = chrome.i18n.getMessage("appNotSupported");
  a.appendChild(document.createTextNode(b));
  document.getElementById("errordiv").style.display = "block"
};
Plugin.prototype.doLayout_ = function (a) {
  var b = this.computeLayout_(a, this.getWindowBounds_(), getCurrentZoom());
  this.applyLayout_(a, b)
};
Plugin.prototype.computeLayout_ = function (a, b, c) {
  if (this.initializing_)throw"doLayout_ should not be called during initialization!";
  var d = {
    top: 0,
    left: 0,
    height: 0,
    width: 0
  }, e = !1, f = 90 == this.rotation_ || 270 == this.rotation_, g = f ? this.metadata_.width : this.metadata_.height, h = f ? this.metadata_.height : this.metadata_.width, l = this.previousZoom_ != c;
  this.previousZoom_ = c;
  var k;
  l || a && !this.isWindowMaximized_() ? (k = h, b = g) : (k = b.width / c, b = b.height / c - _TOPBAR_HEIGHT);
  var n = k / b, m = h / g;
  if (l || !this.isWindowMaximized_() && !a && (k <
    h || b < g))e = !0;
  k < h || b < g ? (d.height = this.metadata_.height, d.width = this.metadata_.width) : n > m ? (d.height = b, d.width = Math.floor(b * m), d.left = Math.floor((k - d.width) / 2)) : (d.height = Math.floor(k / m), d.width = k, d.top = Math.floor((b - d.height) / 2));
  f && (d.top += (d.height - d.width) / 2, d.left += (d.width - d.height) / 2, a = d.width, d.width = d.height, d.height = a);
  return {
    containerSize: {width: k, height: b},
    pluginBounds: d,
    resizeWindow: e,
    windowSize: {width: h * c, height: (g + _TOPBAR_HEIGHT) * c},
    zoomChanged: l
  }
};
Plugin.prototype.applyLayout_ = function (a, b) {
  var c = document.getElementById("appdiv"), d = this.appPlugin_;
  this.rotation_ != this.cachedRotation_ && d && (d.style.opacity = 0, setTimeout(function () {
    d.style.opacity = 1
  }, 400), d.style.webkitTransform = "rotate(-" + this.rotation_ + "deg)", this.cachedRotation_ = this.rotation_);
  (a || b.zoomChanged) && chrome.app.window.current().innerBounds.setMinimumSize(Math.round(b.windowSize.width), Math.round(b.windowSize.height));
  b.resizeWindow && window.resizeTo(b.windowSize.width, b.windowSize.height);
  c.style.width = b.containerSize.width + "px";
  c.style.height = b.containerSize.height + "px";
  d && (d.setAttribute("width", b.pluginBounds.width), d.setAttribute("height", b.pluginBounds.height), d.style.top = b.pluginBounds.top + "px", d.style.left = b.pluginBounds.left + "px", d.style.position = "absolute")
};
Plugin.prototype.setRotation_ = function (a) {
  if (this.rotation_ != a)if (0 != a && 90 != a && 180 != a && 270 != a)console.log("Rotation (" + a + "deg) is not supported."); else {
    var b = 0 == a || 180 == a ? this.metadata_.width : this.metadata_.height, c = 0 == a || 180 == a ? this.metadata_.height : this.metadata_.width, c = c + _TOPBAR_HEIGHT, d = getCurrentZoom(), c = c * d, b = b * d;
    chrome.app.window.current().innerBounds.setMinimumSize(b, c);
    this.rotation_ = a;
    this.doLayout_(!1)
  }
};
Plugin.prototype.setBackButtonEnabled_ = function (a) {
  this.backButtonEnabled_ = a;
  this.setTopbarImagesAndVisibility_(null)
};
Plugin.prototype.handleClipboardMessage_ = function (a) {
  "pushhost" != a.command && "pullhost" != a.command ? console.log("Received unknown clipboard message: " + JSON.stringify(a)) : chrome.runtime.sendMessage(a, function (a) {
    this.postMessage(a)
  }.bind(this))
};
Plugin.prototype.handleDisplayMessage_ = function (a) {
  "config" == a.command ? this.setRotation_(a.data.rotation) : "setBackButtonUIEnabled" == a.command ? this.metadata_.disableAutoBackButton || this.setBackButtonEnabled_(a.data.enable) : "showNoGpu" == a.command ? (this.showNotSupported_(), this.crashExtraInformation_.sig = "MissingGPUSupport", this.reportCrash_("Missing GPU support", null)) : "showInvalidPlayServices" == a.command ? (this.showNotSupported_(), a = {play_services_error_code: a.data ? a.data.errorCode : -1}, this.crashExtraInformation_.sig =
    "InvalidPlayServices", this.reportCrash_("Invalid Play Services", null, a)) : console.log("Received unknown display command: " + a.command)
};
Plugin.prototype.handleBrowserMessage_ = function (a) {
  "openUrl" == a.command ? window.open(a.data.data) : (console.log("Received unknown intent message: "), console.log(a))
};
Plugin.prototype.handleSystemMessage_ = function (a) {
  "reboot" == a.command ? (console.log("Reboot requested"), this.closeWindow_(), chrome.runtime.reload()) : "shutDown" == a.command ? (console.log("Shut down requested"), this.closeWindow_()) : "activityStackEmpty" == a.command ? this.metadata_.allowEmptyActivityStack || (console.log("Activity stack is empty. Shutting down."), this.closeWindow_()) : "enableCrashReporting" == a.command ? (a.data.enabled && console.log("Crash reporting is enabled"), this.backgroundPage_.crashReporter.setCrashReportingEnabled(a.data.enabled)) :
    console.log("Received unknown system message: " + a)
};
Plugin.prototype.relayGcmMessage_ = function (a) {
  var b = this.backgroundPage_.gcm;
  b ? b.handleGcmRequest(a, this) : console.error("Play Services is likely not enabled.")
};
Plugin.prototype.handleMediaStreamMessage_ = function (a) {
  if ("audioOpenCall" == a.command)if (null != this.audioTrack_) {
    console.error("Only one audio track may be opened at a time");
    var b = {namespace: a.data.requester, command: "rpcReturn", data: {requestId: a.data.requestId, result: null}};
    this.postMessage(b)
  } else navigator.webkitGetUserMedia({audio: !0}, function (b) {
      this.audioTrack_ = b.getAudioTracks()[0];
      this.postMessage({
        namespace: a.data.requester,
        command: "rpcReturn",
        data: {requestId: a.data.requestId, result: this.audioTrack_}
      })
    }.bind(this),
    function (b) {
      console.error("Audio stream failed to open", b);
      this.postMessage({
        namespace: a.data.requester,
        command: "rpcReturn",
        data: {requestId: a.data.requestId, result: null}
      })
    }.bind(this)); else"audioCloseCall" == a.command ? (null != this.audioTrack_ && (this.audioTrack_.stop(), this.audioTrack_ = null), b = {
    namespace: a.data.requester,
    command: "rpcReturn",
    data: {requestId: a.data.requestId, result: !0}
  }, this.postMessage(b)) : "videoOpenCall" == a.command ? null != this.videoTrack_ ? (console.error("Only one video track may be opened at a time"),
    b = {
      namespace: a.data.requester,
      command: "rpcReturn",
      data: {requestId: a.data.requestId, result: null}
    }, this.postMessage(b)) : navigator.webkitGetUserMedia({video: {optional: [{minHeight: 640}]}}, function (b) {
    this.videoTrack_ = b.getVideoTracks()[0];
    this.postMessage({
      namespace: a.data.requester,
      command: "rpcReturn",
      data: {requestId: a.data.requestId, result: this.videoTrack_}
    })
  }.bind(this), function (b) {
    console.error("Video stream failed to open", b);
    this.postMessage({
      namespace: a.data.requester, command: "rpcReturn", data: {
        requestId: a.data.requestId,
        result: null
      }
    })
  }.bind(this)) : "videoCloseCall" == a.command ? (null != this.videoTrack_ && (this.videoTrack_.stop(), this.videoTrack_ = null), b = {
    namespace: a.data.requester,
    command: "rpcReturn",
    data: {requestId: a.data.requestId, result: !0}
  }, this.postMessage(b)) : console.log("Received unknown media stream message: " + a)
};
Plugin.prototype.handleHeartbeatMessage_ = function (a) {
  "pong" == a.command ? this.waitingForHeartbeat_ = !1 : "stackTrace" == a.command ? (this.crashExtraInformation_.upload_file_stack_traces = a.data.upload_file_stack_traces, this.heartbeatSendCrash_()) : console.log("Received unknown heartbeat message: " + a)
};
Plugin.prototype.handleChildPluginMessage_ = function (a) {
  ChildPlugin.handleChildPluginMessage(a, this.postMessage.bind(this), this.postMessage.bind(this), this.postMessage.bind(this))
};
Plugin.prototype.setTopbarImagesAndVisibility_ = function (a) {
  this.topbar_ || this.initializeTopBar_(document.getElementById("topbar"));
  var b = ["back", "minimize", "maximize", "close"], c = this.isFocusedWindow_;
  null != a && (this.isFocusedWindow_ = a);
  for (a = 0; a < b.length; ++a) {
    var d = document.getElementById(b[a] + "-button");
    c != this.isFocusedWindow_ && (d.src = (this.isFocusedWindow_ ? "" : "in") + "active_window_" + b[a] + ".png");
    d.className = this.isFocusedWindow_ ? "button" : "inactbutton";
    "back" == b[a] ? d.className = this.backButtonEnabled_ ?
      "button" : "hiddenbutton" : "maximize" == b[a] && "disabled" == this.metadata_.resize ? d.className = "hiddenbutton" : "extdir-button" != b[a] && (d.className = "button")
  }
  this.topbar_.className = this.isFocusedWindow_ ? "" : "inact"
};
Plugin.prototype.handleMouseDown_ = function (a) {
  0 == a.button && (this.pressedButton_ = a.currentTarget, a.cancelBubble = !0)
};
Plugin.prototype.handleMouseUp_ = function (a) {
  if (0 == a.button) {
    var b = this.pressedButton_;
    this.pressedButton_ = null;
    b == a.currentTarget && ("minimize-button" == b.id && this.minimizeWindow_(), "maximize-button" == b.id ? "disabled" != this.metadata_.resize && (this.isWindowMaximized_() ? this.restoreWindow_() : this.maximizeWindow_()) : "close-button" == b.id ? this.closeWindow_() : "back-button" == b.id ? this.backButtonEnabled_ && this.postMessage({
      namespace: "pluginInputManager",
      command: "simulateButton",
      data: {button: "backButton"}
    }) :
    "extdir-button" == b.id && this.fileSystemManager_.openAndMountExternalDirectory(!0));
    (a = document.getElementById("app-plugin")) && a.focus()
  }
};
Plugin.prototype.initializeTopBar_ = function (a) {
  if (this.initializing_)throw"initializeTopBar_ should not be called during initialization!";
  this.topbar_ = a;
  document.body.dir = chrome.i18n.getMessage("@@bidi_dir");
  a.addEventListener("mousedown", this.handleMouseDown_.bind(this));
  a = ["back-button", "extdir-button", "minimize-button", "maximize-button", "close-button"];
  for (var b = 0; b < a.length; ++b) {
    var c = document.getElementById(a[b]);
    c.addEventListener("mousedown", this.handleMouseDown_.bind(this));
    c.addEventListener("mouseup",
      this.handleMouseUp_.bind(this))
  }
  window.addEventListener("mouseup", this.handleMouseUp_.bind(this));
  window.onblur = function () {
    this.pressedButton_ != this.topbar_ && (this.setTopbarImagesAndVisibility_(!1), this.pressedButton_ = null)
  }.bind(this);
  window.onfocus = function () {
    this.pressedButton_ = null;
    this.setTopbarImagesAndVisibility_(!0)
  }.bind(this)
};
Plugin.prototype.getWindowBounds_ = function () {
  return chrome.app.window ? chrome.app.window.current().innerBounds : {width: 0, height: 0}
};
Plugin.prototype.isWindowMaximized_ = function () {
  return chrome.app.window && chrome.app.window.current().isMaximized()
};
Plugin.prototype.maximizeWindow_ = function () {
  chrome.app.window && chrome.app.window.current().maximize()
};
Plugin.prototype.restoreWindow_ = function () {
  chrome.app.window && chrome.app.window.current().restore()
};
Plugin.prototype.showWindow = function () {
  chrome.app.window && chrome.app.window.current().show()
};
Plugin.prototype.onRelaunched = function (a) {
  window.arc.launchArgs = a;
  a.items && this.shell(_FILE_HANDLER_LAUNCH_ARG.join(" "));
  chrome.app.window.current().focus()
};
Plugin.prototype.getMetadata = function () {
  return this.metadata_
};
Plugin.prototype.minimizeWindow_ = function () {
  chrome.app.window.current().minimize();
  var a = document.getElementById("minimize-button");
  a.style.backgroundColor = "#FFF";
  setTimeout(function () {
    a.addEventListener("mouseenter", function () {
      a.style.backgroundColor = "";
      a.removeEventListener("mouseenter", arguments.callee, !1)
    }, !1)
  }, 0)
};
Plugin.prototype.handleIapMessage_ = function (a) {
  var b = function (a, b) {
    this.postMessage({namespace: "javaIap", command: b, data: a})
  }.bind(this);
  if ("getSkuDetails" == a.command) {
    var c = function (a) {
      b(a, "getSkuDetailsResponse")
    };
    google.payments.inapp.getSkuDetails({parameters: {env: "prod"}, success: c, failure: c})
  } else"buy" == a.command ? (c = function (a) {
    b(a, "buyResponse")
  }, google.payments.inapp.buy({
    parameters: {env: "prod"},
    sku: a.data.sku,
    success: c,
    failure: c
  })) : "getPurchases" == a.command ? (c = function (a) {
    b(a, "getPurchasesResponse")
  },
    google.payments.inapp.getPurchases({
      parameters: {env: "prod"},
      success: c,
      failure: c
    })) : "consumePurchase" == a.command ? (c = function (a) {
    b(a, "consumePurchaseResponse")
  }, google.payments.inapp.consumePurchase({
    parameters: {env: "prod"},
    sku: a.data.sku,
    success: c,
    failure: c
  })) : console.error("Received unknown IAP command: " + a.command)
};
console.assert(window.arc);
console.assert(window.arc.launchArgs);
var plugin = null;
if (!window.arc.launchArgs.suppressPluginInit) {
  var times = {app_launch_time: window.arc.appLaunchTime}, plugin = new Plugin(times);
  plugin.init()
}
window.arc.systemDirectoriesReady && (window.arc.systemDirectoriesReady = PromiseBridge.createPromise(window.arc.systemDirectoriesReady));
//# sourceMappingURL=gen_index.min.js.map
